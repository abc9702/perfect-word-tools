<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≥–æ—Ä–æ–¥–æ–≤</title>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª—å –¥–ª—è –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞ */
        .file-info {
            background-color: #f8f9fa;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 13px;
            color: #2c3e50;
        }
        
        .file-info-header {
            font-weight: 600;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .file-info-content {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        
        .file-status {
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .file-status-new {
            background-color: #2ecc71;
            color: white;
        }
        
        .file-status-loaded {
            background-color: #3498db;
            color: white;
        }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            height: calc(100vh - 40px);
        }
        
        .sidebar {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            max-height: 100%;
            min-height: 0;
        }
        
        .sidebar-content {
            flex: 1 1 auto;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-height: 0;
        }
        
        .main-content {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 0;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #3498db;
            font-size: 24px;
        }
        
        h2 {
            color: #34495e;
            margin: 15px 0 10px 0;
            font-size: 18px;
        }
        
        h3 {
            color: #2c3e50;
            padding: 15px 20px;
            margin: 0;
            border-bottom: 1px solid #eee;
            background-color: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section {
            margin-bottom: 0;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            flex-shrink: 0;
            min-height: 100px;
            max-height: 200px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .section-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-shrink: 0;
            padding: 0 5px;
        }
        
        .section-title h4 {
            margin: 0;
            color: #34495e;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .section-title h4:hover {
            color: #3498db;
            text-decoration: underline;
        }
        
        .list-container {
            flex: 1 1 auto;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            min-height: 50px;
            max-height: 140px;
        }
        
        .list-item {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .list-item:hover {
            background-color: #f9f9f9;
        }
        
        .list-item.selected {
            background-color: #e3f2fd;
            border-left: 4px solid #3498db;
        }
        
        .list-item .item-content {
            flex-grow: 1;
            min-width: 0;
        }
        
        .list-item .item-name {
            font-weight: 600;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            font-size: 13px;
        }
        
        .list-item .item-id {
            font-size: 11px;
            color: #7f8c8d;
        }
        
        .list-item .item-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .list-item:hover .item-actions {
            opacity: 1;
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            height: 36px;
            min-width: 90px;
            box-sizing: border-box;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn-delete {
            background-color: #e74c3c;
            padding: 4px 8px;
            font-size: 12px;
            height: 36px;
            min-width: auto;
            width: 36px;
        }
        
        #modalClosePointBtn {			
            width: 36px;
            height: 36px;
        }
        
        .btn-delete:hover {
            background-color: #c0392b;
        }
        
        .btn-add, .btn-export, .file-label, .btn-back {
            background-color: #2ecc71;
            width: 128px;
            padding: 8px;
            height: 45px;
        }
        
        .btn-add:hover {
            background-color: #27ae60;
        }
        
        .btn-add-small {
            background-color: #2ecc71;
            padding: 0;
            font-size: 14px;
            height: 24px;
            width: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: auto;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            color: white;
        }
        
        .btn-add-small:hover {
            background-color: #27ae60;
        }
        
        .btn-export {
            background-color: #9b59b6;
        }
        
        .btn-export:hover {
            background-color: #8e44ad;
        }
        
        .btn-back {
            background-color: #95a5a6;
            margin-right: 10px;
        }
        
        .btn-back:hover {
            background-color: #7f8c8d;
        }
        
        #modalDeletePointBtn {
            min-width: 90px;
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
            font-family: monospace;
            font-size: 13px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .checkbox-group label {
            margin-left: 8px;
            font-weight: normal;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .point-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 15px;
            padding: 20px;
        }
        
        .point-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #fafafa;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .point-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
            border-color: #3498db;
        }
        
        .point-card h4 {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .point-id {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .point-coords {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .point-coords input {
            width: 100%;
        }
        
        .point-collected {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .empty-message {
            text-align: center;
            padding: 40px 20px;
            color: #95a5a6;
            font-style: italic;
            font-size: 14px;
        }
        
        .status-bar {
            margin-top: auto;
            padding-top: 15px;
            border-top: 1px solid #eee;
            font-size: 13px;
            color: #7f8c8d;
            flex-shrink: 0;
        }
        
        .file-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .file-controls input[type="file"] {
            display: none;
        }
        
        .file-label {
            background-color: #34495e;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-sizing: border-box;
        }
        
        .file-label:hover {
            background-color: #2c3e50;
        }
        
        .icon-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 5px;
        }
        
        .icon-option {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }
        
        .icon-option:hover {
            background-color: #f0f0f0;
        }
        
        .icon-option.selected {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            background-color: #f8f9fa;
        }
        
        .content-area {
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
        }
        
        .breadcrumb {
            font-size: 14px;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .breadcrumb-item {
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .breadcrumb-item:hover {
            color: #3498db;
            text-decoration: underline;
        }
        
        .breadcrumb-separator {
            margin: 0 5px;
        }
        
        .edit-form {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.2s;
        }
        
        .close-btn:hover {
            color: #e74c3c;
        }
        
        .icon-preview {
            display: inline-block;
            width: 24px;
            height: 24px;
            background-color: #eee;
            border-radius: 4px;
            margin-right: 8px;
            text-align: center;
            line-height: 24px;
            font-size: 14px;
        }
        
        .city-list, .category-list, .activity-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            padding: 20px;
        }
        
        .city-card, .category-card, .activity-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #fafafa;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .city-card:hover, .category-card:hover, .activity-card:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
            border-color: #3498db;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .card-actions {
            display: flex;
            gap: 5px;
        }
        
        .card-content {
            margin-top: 10px;
        }
        
        .card-stats {
            font-size: 12px;
            color: #7f8c8d;
            display: flex;
            gap: 10px;
            margin-top: 8px;
        }
        
        .input-inline {
            border: none;
            background: transparent;
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
            width: 100%;
            padding: 2px 0;
            border-bottom: 1px dashed #ddd;
            transition: border-color 0.2s;
        }
        
        .input-inline:focus {
            outline: none;
            border-bottom: 2px solid #3498db;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            padding: 0 20px;
        }
        
        .view-toggle-btn {
            padding: 8px 16px;
            background-color: #f0f0f0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .view-toggle-btn:hover {
            background-color: #e0e0e0;
        }
        
        .view-toggle-btn.active {
            background-color: #3498db;
            color: white;
        }
        
        .list-view {
            padding: 0;
        }
        
        .list-view-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .list-view-table th {
            background-color: #f8f9fa;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            font-size: 14px;
        }
        
        .list-view-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }
        
        .list-view-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .list-view-table tr.selected {
            background-color: #e3f2fd;
        }
        
        .list-view-table input,
        .list-view-table select {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            transition: border-color 0.2s;
        }
        
        .list-view-table input:focus,
        .list-view-table select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .list-view-actions {
            display: flex;
            gap: 5px;
        }
        
        .auto-navigate-checkbox {
            margin: 0 20px 15px 20px;
            padding: 12px 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #eee;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .section-header h2 {
            margin: 0;
            color: #2c3e50;
        }
        
        .edit-info {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #eee;
        }
        
        .edit-info-row {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }
        
        .edit-info-label {
            font-weight: 600;
            color: #2c3e50;
            min-width: 120px;
        }
        
        .edit-info-value {
            color: #34495e;
        }
        
        @media (max-width: 1100px) {
            .container {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .sidebar {
                max-height: 400px;
            }
        }
        
        @media (max-width: 768px) {
            .point-list, .city-list, .category-list, .activity-list {
                grid-template-columns: 1fr;
            }
            
            .list-view-table {
                display: block;
                overflow-x: auto;
            }
            
            .file-controls {
                flex-direction: column;
            }
            
            .btn, .file-label {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h1>
            
            <!-- –î–æ–±–∞–≤–ª—è–µ–º –±–ª–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ñ–∞–π–ª–µ -->
            <div id="fileInfo" class="file-info">
                <div class="file-info-header">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ:</div>
                <div class="file-info-content">
                    <div id="fileStatus" class="file-status file-status-new">–ù–æ–≤—ã–π —Ñ–∞–π–ª</div>
                    <div id="fileName"></div>
                </div>
            </div>
            
            <div class="file-controls">
                <label class="file-label" for="fileInput">
                    <span>üìÇ</span> –ó–∞–≥—Ä—É–∑–∏—Ç—å
                </label>
                <input type="file" id="fileInput" accept=".json">
                <button class="btn btn-export" id="exportBtn">
                    <span>üíæ</span> –≠–∫—Å–ø–æ—Ä—Ç
                </button>
                <button class="btn btn-add" id="newFile">
                    <span>+</span> –ù–æ–≤—ã–π —Ñ–∞–π–ª
                </button>
            </div>
            
            <div class="sidebar-content">
                <div class="section">
                    <div class="section-title">
                        <h4 onclick="showCitiesView()">–ì–æ—Ä–æ–¥–∞</h4>
                        <button class="btn-add-small" id="addCityFromSidebar" title="–î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥">+</button>
                    </div>
                    <div class="list-container" id="citiesNavList"></div>
                </div>
                
                <div class="section">
                    <div id="categoriesNavSection" style="display: none;">
                        <div class="section-title">
                            <h4 onclick="showCityView(currentView.cityIndex)">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h4>
                            <button class="btn-add-small" id="addCategoryFromSidebar" title="–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é">+</button>
                        </div>
                        <div class="list-container" id="categoriesNavList"></div>
                    </div>
                </div>
                
                <div class="section">
                    <div id="activitiesNavSection" style="display: none;">
                        <div class="section-title">
                            <h4 onclick="showCategoryView(currentView.cityIndex, currentView.categoryIndex)">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h4>
                            <button class="btn-add-small" id="addActivityFromSidebar" title="–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å">+</button>
                        </div>
                        <div class="list-container" id="activitiesNavList"></div>
                    </div>
                </div>
                
                <div class="section">
                    <div id="pointsNavSection" style="display: none;">
                        <div class="section-title">
                            <h4 onclick="showActivityView(currentView.cityIndex, currentView.categoryIndex, currentView.activityIndex)">–¢–æ—á–∫–∏</h4>
                            <button class="btn-add-small" id="addPointFromSidebar" title="–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É">+</button>
                        </div>
                        <div class="list-container" id="pointsNavList"></div>
                    </div>
                </div>
            </div>
            
            <div class="status-bar" id="statusBar">
                –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
            </div>
        </div>
        
        <div class="main-content">
            <div class="header">
                <div class="breadcrumb" id="breadcrumb">
                    <span class="breadcrumb-item" data-type="root">–†–µ–¥–∞–∫—Ç–æ—Ä</span>
                </div>
                <div id="headerActions"></div>
            </div>
            
            <div class="auto-navigate-checkbox">
                <div class="checkbox-group">
                    <input type="checkbox" id="autoNavigate">
                    <label for="autoNavigate">–ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É</label>
                </div>
            </div>
            
            <div id="content">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è—Ç—å—Å—è -->
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ—á–∫–∏ -->
    <div id="pointModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏</h3>
                <button class="close-btn" id="closePointModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="edit-form">
                    <div class="point-coords">
                        <div class="form-group">
                            <label for="modalPointX">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X</label>
                            <input type="number" id="modalPointX" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="modalPointY">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ Y</label>
                            <input type="number" id="modalPointY" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="modalPointHeight">–í—ã—Å–æ—Ç–∞</label>
                            <input type="number" id="modalPointHeight" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="modalPointLabel">–ú–µ—Ç–∫–∞</label>
                        <input type="text" id="modalPointLabel" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –º–µ—Ç–∫—É">
                    </div>
                    
                    <div class="form-group">
                        <label for="modalPointDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="modalPointDescription" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ—á–∫–∏" rows="4"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="modalPointNote">–ó–∞–º–µ—Ç–∫–∞</label>
                        <textarea id="modalPointNote" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É" rows="3"></textarea>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="modalPointCollected">
                        <label for="modalPointCollected">–°–æ–±—Ä–∞–Ω–æ</label>
                    </div>
                    
                    <div class="form-group">
                        <label>ID: <span id="modalPointId" style="font-family: monospace; background-color: #f0f0f0; padding: 2px 6px; border-radius: 3px;"></span></label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-back" id="modalClosePointBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="btn btn-delete" id="modalDeletePointBtn">–£–¥–∞–ª–∏—Ç—å —Ç–æ—á–∫—É</button>
                <button class="btn" id="modalSavePointBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        let data = {
            "version": 1,
            "nextCityId": 1,
            "cities": []
        };
        
        // –ë–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è nextId –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        let fileBaseline = null;
        
        // –ò–º—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
        let loadedFileName = null;
        
        // –ò—Å—Ç–æ—Ä–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        let navigationHistory = [];
        let currentView = {
            type: 'cities', // 'cities', 'city', 'category', 'activity'
            cityIndex: -1,
            categoryIndex: -1,
            activityIndex: -1,
            viewMode: 'list' // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–ø–∏—Å–æ–∫
        };
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        let autoNavigate = false; // –ò–∑–º–µ–Ω–µ–Ω–æ: –æ—Ç–∫–ª—é—á–µ–Ω–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        
        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const content = document.getElementById('content');
        const breadcrumb = document.getElementById('breadcrumb');
        const headerActions = document.getElementById('headerActions');
        const statusBar = document.getElementById('statusBar');
        const autoNavigateCheckbox = document.getElementById('autoNavigate');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ
        const fileInfo = document.getElementById('fileInfo');
        const fileStatus = document.getElementById('fileStatus');
        const fileName = document.getElementById('fileName');
        
        // –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Å–∞–π–¥–±–∞—Ä–µ
        const addCityFromSidebar = document.getElementById('addCityFromSidebar');
        const addCategoryFromSidebar = document.getElementById('addCategoryFromSidebar');
        const addActivityFromSidebar = document.getElementById('addActivityFromSidebar');
        const addPointFromSidebar = document.getElementById('addPointFromSidebar');
        
        // –°–µ–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        const citiesNavList = document.getElementById('citiesNavList');
        const categoriesNavSection = document.getElementById('categoriesNavSection');
        const categoriesNavList = document.getElementById('categoriesNavList');
        const activitiesNavSection = document.getElementById('activitiesNavSection');
        const activitiesNavList = document.getElementById('activitiesNavList');
        const pointsNavSection = document.getElementById('pointsNavSection');
        const pointsNavList = document.getElementById('pointsNavList');
        
        // –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏
        const newFileBtn = document.getElementById('newFile');
        const fileInput = document.getElementById('fileInput');
        const exportBtn = document.getElementById('exportBtn');
        
        // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–æ—á–∫–∏
        const pointModal = document.getElementById('pointModal');
        const closePointModal = document.getElementById('closePointModal');
        const modalClosePointBtn = document.getElementById('modalClosePointBtn');
        const modalSavePointBtn = document.getElementById('modalSavePointBtn');
        const modalDeletePointBtn = document.getElementById('modalDeletePointBtn');
        
        // –ü–æ–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ç–æ—á–∫–∏
        const modalPointX = document.getElementById('modalPointX');
        const modalPointY = document.getElementById('modalPointY');
        const modalPointHeight = document.getElementById('modalPointHeight');
        const modalPointLabel = document.getElementById('modalPointLabel');
        const modalPointDescription = document.getElementById('modalPointDescription');
        const modalPointNote = document.getElementById('modalPointNote');
        const modalPointCollected = document.getElementById('modalPointCollected');
        const modalPointId = document.getElementById('modalPointId');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        function init() {
            // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ localStorage
			restoreState();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
            updateFileInfo();
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
            newFileBtn.addEventListener('click', createNewFile);
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
            fileInput.addEventListener('change', handleFileUpload);
            
            // –≠–∫—Å–ø–æ—Ä—Ç —Ñ–∞–π–ª–∞
            exportBtn.addEventListener('click', exportData);
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥–∞
            autoNavigateCheckbox.checked = autoNavigate; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ–∫–±–æ–∫—Å–∞
            autoNavigateCheckbox.addEventListener('change', function() {
                autoNavigate = this.checked;
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ localStorage
                localStorage.setItem('autoNavigate', this.checked.toString());
            });
            
            // –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ —Å–∞–π–¥–±–∞—Ä–µ
            addCityFromSidebar.addEventListener('click', addCity);
            addCategoryFromSidebar.addEventListener('click', () => {
                if (currentView.cityIndex !== -1) {
                    addCategory(currentView.cityIndex);
                }
            });
            addActivityFromSidebar.addEventListener('click', () => {
                if (currentView.cityIndex !== -1 && currentView.categoryIndex !== -1) {
                    addActivity(currentView.cityIndex, currentView.categoryIndex);
                }
            });
            addPointFromSidebar.addEventListener('click', () => {
                if (currentView.cityIndex !== -1 && currentView.categoryIndex !== -1 && currentView.activityIndex !== -1) {
                    addPoint(currentView.cityIndex, currentView.categoryIndex, currentView.activityIndex);
                }
            });
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–æ—á–∫–∏
            closePointModal.addEventListener('click', () => pointModal.style.display = 'none');
            modalClosePointBtn.addEventListener('click', () => pointModal.style.display = 'none');
            modalSavePointBtn.addEventListener('click', savePointInModal);
            modalDeletePointBtn.addEventListener('click', deletePointInModal);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
            setupAutoSave();
            
            updateStatusBar("–°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞");
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ
        function updateFileInfo() {
            if (fileBaseline) {
                fileStatus.textContent = "–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª";
                fileStatus.className = "file-status file-status-loaded";
                
                if (loadedFileName) {
                    fileName.textContent = `–ò–º—è —Ñ–∞–π–ª–∞: ${loadedFileName}`;
                    fileName.title = `–ó–∞–≥—Ä—É–∂–µ–Ω –∏–∑ —Ñ–∞–π–ª–∞: ${loadedFileName}`;
                } else {
                    fileName.textContent = "–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è";
                    fileName.title = "–§–∞–π–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ localStorage";
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É
                fileInfo.title = "–†–∞–±–æ—Ç–∞ —Å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–æ–º. ID –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –±–∞–∑–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏–∑ —Ñ–∞–π–ª–∞.";
            } else {
                fileStatus.textContent = "–ù–æ–≤—ã–π —Ñ–∞–π–ª";
                fileStatus.className = "file-status file-status-new";
                fileName.textContent = "–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª";
                fileName.title = "";
                fileInfo.title = "–†–∞–±–æ—Ç–∞ —Å –Ω–æ–≤—ã–º —Ñ–∞–π–ª–æ–º. ID –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 1.";
            }
        }
        
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ localStorage
        function restoreState() {
            try {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                const savedData = localStorage.getItem('editorData');
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData.version && parsedData.nextCityId !== undefined && parsedData.cities) {
                        data = parsedData;
                    }
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                const savedBaseline = localStorage.getItem('editorBaseline');
                if (savedBaseline) {
                    fileBaseline = JSON.parse(savedBaseline);
                } else {
					fileBaseline = null;
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞
                const savedFileName = localStorage.getItem('editorFileName');
                if (savedFileName) {
                    loadedFileName = savedFileName;
                } else {
                    loadedFileName = null;
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                const savedAutoNavigate = localStorage.getItem('autoNavigate');
                if (savedAutoNavigate !== null) {
                    autoNavigate = savedAutoNavigate === 'true';
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                const savedView = localStorage.getItem('editorView');
                if (savedView) {
                    currentView = JSON.parse(savedView);
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                const savedHistory = localStorage.getItem('editorHistory');
                if (savedHistory) {
                    navigationHistory = JSON.parse(savedHistory);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                updateUI();
            } catch (error) {
                console.warn("–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:", error);
                // –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª
                createNewFile();
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ localStorage
        function saveState() {
			try {
				localStorage.setItem('editorData', JSON.stringify(data));
                localStorage.setItem('editorBaseline', JSON.stringify(fileBaseline));
                localStorage.setItem('editorFileName', loadedFileName || '');
                localStorage.setItem('autoNavigate', autoNavigate.toString());
                localStorage.setItem('editorView', JSON.stringify(currentView));
                localStorage.setItem('editorHistory', JSON.stringify(navigationHistory));
            } catch (error) {
                console.warn("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:", error);
            }
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        function setupAutoSave() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
            const originalMethods = {
                updateCity,
                updateCategory,
                updateActivity,
                updatePoint,
                addCity,
                addCategory,
                addActivity,
                addPoint,
                deleteCity,
                deleteCategory,
                deleteActivity,
                deletePoint
            };
            
            // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–æ–¥—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
            for (const methodName in originalMethods) {
                if (typeof window[methodName] === 'function') {
                    const originalMethod = window[methodName];
                    window[methodName] = function(...args) {
                        const result = originalMethod.apply(this, args);
                        saveState();
                        updateFileInfo(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
                        return result;
                    };
                }
            }
            
            // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
            const originalViewMethods = {
                showCitiesView,
                showCityView,
                showCategoryView,
                showActivityView,
                goBack,
                toggleViewMode
            };
            
            for (const methodName in originalViewMethods) {
                if (typeof window[methodName] === 'function') {
                    const originalMethod = window[methodName];
                    window[methodName] = function(...args) {
                        const result = originalMethod.apply(this, args);
                        saveState();
                        return result;
                    };
                }
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
        function createNewFile() {
            data = {
                "version": 1,
                "nextCityId": 1,
                "cities": []
            };
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
            fileBaseline = null;
            loadedFileName = null;
            
            currentView = {
                type: 'cities',
                cityIndex: -1,
                categoryIndex: -1,
                activityIndex: -1,
                viewMode: 'list'
            };
            
            navigationHistory = [];
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            saveState();
            
            updateFileInfo();
            updateUI();
            updateStatusBar("–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª");
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const parsedData = JSON.parse(e.target.result);
                    
                    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                    if (!parsedData.version || !parsedData.nextCityId || !parsedData.cities) {
                        throw new Error("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞");
                    }
                    
                    data = parsedData;
                    
                    // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —Ñ–∞–π–ª–∞
                    fileBaseline = {
                        nextCityId: data.nextCityId,
                        cities: {}
                    };
                    
                    data.cities.forEach((city, cityIndex) => {
                        fileBaseline.cities[city.id] = {
                            nextCategoryId: city.nextCategoryId,
                            categories: {}
                        };
                        
                        city.categories.forEach((category, catIndex) => {
                            fileBaseline.cities[city.id].categories[category.id] = {
                                nextActivityId: category.nextActivityId,
                                activities: {}
                            };
                            
                            category.activities.forEach((activity, actIndex) => {
                                fileBaseline.cities[city.id].categories[category.id].activities[activity.id] = {
                                    nextPointId: activity.nextPointId
                                };
                            });
                        });
                    });
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è —Ñ–∞–π–ª–∞
                    loadedFileName = file.name;
                    
                    currentView = {
                        type: 'cities',
                        cityIndex: -1,
                        categoryIndex: -1,
                        activityIndex: -1,
                        viewMode: 'list'
                    };
                    
                    navigationHistory = [];
                    
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    saveState();
                    
                    updateFileInfo();
                    updateUI();
                    updateStatusBar(`–§–∞–π–ª "${file.name}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`);
                } catch (error) {
                    alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: ${error.message}`);
                }
            };
            
            reader.readAsText(file);
            event.target.value = '';
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–º—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–ª–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –Ω–æ–≤–æ–µ
            let exportFileName;
            if (fileBaseline && loadedFileName) {
                // –î–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –¥–æ–±–∞–≤–ª—è–µ–º —Å—É—Ñ—Ñ–∏–∫—Å
                const nameWithoutExt = loadedFileName.replace(/\.[^/.]+$/, "");
                exportFileName = `${nameWithoutExt}_modified.json`;
            } else {
                // –î–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏–º—è
                exportFileName = `cities_data_${new Date().toISOString().slice(0, 10)}.json`;
            }
            
            a.download = exportFileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            updateStatusBar("–§–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω");
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π ID –∏–∑ –º–∞—Å—Å–∏–≤–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function getMaxId(elements, prefix) {
            if (elements.length === 0) return 0;
            
            const ids = elements
                .map(item => {
                    const match = item.id.match(new RegExp(`^${prefix}(\\d+)$`));
                    return match ? parseInt(match[1]) : 0;
                })
                .filter(id => !isNaN(id));
            
            return ids.length > 0 ? Math.max(...ids) : 0;
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ nextId –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–∞
        function getBaselineNextId(path, type) {
            if (!fileBaseline) return null;
            
            let current = fileBaseline;
            
            for (const segment of path) {
                if (current && current[segment]) {
                    current = current[segment];
                } else {
                    return null;
                }
            }
            
            return current && current[type] !== undefined ? current[type] : null;
        }
        
        // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ nextId
        function adjustNextId(maxId, baselineValue) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Ñ–∞–π–ª–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∞–∫—Å–∏–º—É–º –∏–∑: –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, maxId + 1
            // –ï—Å–ª–∏ –Ω–µ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–æ–≤—ã–π —Ñ–∞–π–ª), –∏—Å–ø–æ–ª—å–∑—É–µ–º maxId + 1 –∏–ª–∏ 1
            const minValue = baselineValue !== null ? baselineValue : 1;
            return Math.max(minValue, maxId + 1);
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≥–æ—Ä–æ–¥–∞
        function addCity() {
            const baselineValue = getBaselineNextId([], 'nextCityId');
            const maxId = getMaxId(data.cities, 'c');
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º nextCityId
            data.nextCityId = adjustNextId(maxId, baselineValue);
            
            const newId = `c${data.nextCityId}`;
            data.nextCityId++;
            
            const newCity = {
                "id": newId,
                "name": `–ù–æ–≤—ã–π –≥–æ—Ä–æ–¥ ${newId}`,
                "nextCategoryId": 1,
                "categories": []
            };
            
            data.cities.push(newCity);
            
            if (autoNavigate) {
                showCityView(data.cities.length - 1);
            }
            
            updateUI();
            updateStatusBar(`–î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –≥–æ—Ä–æ–¥: ${newId}`);
            saveState();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function addCategory(cityIndex) {
            if (cityIndex === -1) return;
            
            const city = data.cities[cityIndex];
            const baselineValue = getBaselineNextId([city.id], 'nextCategoryId');
            const maxId = getMaxId(city.categories, 'cat');
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º nextCategoryId
            city.nextCategoryId = adjustNextId(maxId, baselineValue);
            
            const newId = `cat${city.nextCategoryId}`;
            city.nextCategoryId++;
            
            const newCategory = {
                "id": newId,
                "name": `–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è ${newId}`,
                "nextActivityId": 1,
                "activities": []
            };
            
            city.categories.push(newCategory);
            
            if (autoNavigate) {
                showCategoryView(cityIndex, city.categories.length - 1);
            }
            
            updateUI();
            updateStatusBar(`–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: ${newId}`);
            saveState();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function addActivity(cityIndex, categoryIndex) {
            if (cityIndex === -1 || categoryIndex === -1) return;
            
            const city = data.cities[cityIndex];
            const category = city.categories[categoryIndex];
            const baselineValue = getBaselineNextId([city.id, category.id], 'nextActivityId');
            const maxId = getMaxId(category.activities, 'a');
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º nextActivityId
            category.nextActivityId = adjustNextId(maxId, baselineValue);
            
            const newId = `a${category.nextActivityId}`;
            category.nextActivityId++;
            
            const newActivity = {
                "id": newId,
                "name": `–ù–æ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ${newId}`,
                "icon": null,
                "show": true,
                "nextPointId": 1,
                "points": []
            };
            
            category.activities.push(newActivity);
            
            if (autoNavigate) {
                showActivityView(cityIndex, categoryIndex, category.activities.length - 1);
            }
            
            updateUI();
            updateStatusBar(`–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${newId}`);
            saveState();
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ç–æ—á–∫–∏
        function addPoint(cityIndex, categoryIndex, activityIndex) {
            if (cityIndex === -1 || categoryIndex === -1 || activityIndex === -1) return;
            
            const city = data.cities[cityIndex];
            const category = city.categories[categoryIndex];
            const activity = category.activities[activityIndex];
            const baselineValue = getBaselineNextId([city.id, category.id, activity.id], 'nextPointId');
            const maxId = getMaxId(activity.points, 'p');
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º nextPointId
            activity.nextPointId = adjustNextId(maxId, baselineValue);
            
            const newId = `p${activity.nextPointId}`;
            activity.nextPointId++;
            
            const newPoint = {
                "id": newId,
                "x": 0,
                "y": 0,
                "height": null,
                "label": null,
                "description": "",
                "note": "",
                "collected": false
            };
            
            activity.points.push(newPoint);
            
            updateUI();
            updateStatusBar(`–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ç–æ—á–∫–∞: ${newId}`);
            saveState();
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
        function deleteCity(cityIndex) {
            if (cityIndex === -1) return;
            
            const cityId = data.cities[cityIndex].id;
            data.cities.splice(cityIndex, 1);
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º nextCityId
            const baselineValue = getBaselineNextId([], 'nextCityId');
            const maxId = getMaxId(data.cities, 'c');
            data.nextCityId = adjustNextId(maxId, baselineValue);
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É –≥–æ—Ä–æ–¥–æ–≤
            showCitiesView();
            updateStatusBar(`–£–¥–∞–ª–µ–Ω –≥–æ—Ä–æ–¥: ${cityId}`);
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function deleteCategory(cityIndex, categoryIndex) {
            if (cityIndex === -1 || categoryIndex === -1) return;
            
            const city = data.cities[cityIndex];
            const categoryId = city.categories[categoryIndex].id;
            city.categories.splice(categoryIndex, 1);
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º nextCategoryId
            const baselineValue = getBaselineNextId([city.id], 'nextCategoryId');
            const maxId = getMaxId(city.categories, 'cat');
            city.nextCategoryId = adjustNextId(maxId, baselineValue);
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≥–æ—Ä–æ–¥–∞
            showCityView(cityIndex);
            updateStatusBar(`–£–¥–∞–ª–µ–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è: ${categoryId}`);
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function deleteActivity(cityIndex, categoryIndex, activityIndex) {
            if (cityIndex === -1 || categoryIndex === -1 || activityIndex === -1) return;
            
            const city = data.cities[cityIndex];
            const category = city.categories[categoryIndex];
            const activityId = category.activities[activityIndex].id;
            category.activities.splice(activityIndex, 1);
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º nextActivityId
            const baselineValue = getBaselineNextId([city.id, category.id], 'nextActivityId');
            const maxId = getMaxId(category.activities, 'a');
            category.nextActivityId = adjustNextId(maxId, baselineValue);
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ —Å–ø–∏—Å–∫—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            showCategoryView(cityIndex, categoryIndex);
            updateStatusBar(`–£–¥–∞–ª–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${activityId}`);
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏
        function deletePoint(cityIndex, categoryIndex, activityIndex, pointIndex) {
            if (cityIndex === -1 || categoryIndex === -1 || activityIndex === -1 || pointIndex === -1) return;
            
            const city = data.cities[cityIndex];
            const category = city.categories[categoryIndex];
            const activity = category.activities[activityIndex];
            const pointId = activity.points[pointIndex].id;
            activity.points.splice(pointIndex, 1);
            
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º nextPointId
            const baselineValue = getBaselineNextId([city.id, category.id, activity.id], 'nextPointId');
            const maxId = getMaxId(activity.points, 'p');
            activity.nextPointId = adjustNextId(maxId, baselineValue);
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            pointModal.style.display = 'none';
            updateUI();
            updateStatusBar(`–£–¥–∞–ª–µ–Ω–∞ —Ç–æ—á–∫–∞: ${pointId}`);
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
        function updateCity(cityIndex, newName) {
            if (cityIndex === -1) return;
            
            const city = data.cities[cityIndex];
            city.name = newName;
            
            updateUI();
            updateStatusBar(`–ì–æ—Ä–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω: ${city.id}`);
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function updateCategory(cityIndex, categoryIndex, newName) {
            if (cityIndex === -1 || categoryIndex === -1) return;
            
            const city = data.cities[cityIndex];
            const category = city.categories[categoryIndex];
            category.name = newName;
            
            updateUI();
            updateStatusBar(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${category.id}`);
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function updateActivity(cityIndex, categoryIndex, activityIndex, updates) {
            if (cityIndex === -1 || categoryIndex === -1 || activityIndex === -1) return;
            
            const city = data.cities[cityIndex];
            const category = city.categories[categoryIndex];
            const activity = category.activities[activityIndex];
            
            Object.assign(activity, updates);
            
            updateUI();
            updateStatusBar(`–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${activity.id}`);
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏
        function updatePoint(cityIndex, categoryIndex, activityIndex, pointIndex, updates) {
            if (cityIndex === -1 || categoryIndex === -1 || activityIndex === -1 || pointIndex === -1) return;
            
            const city = data.cities[cityIndex];
            const category = city.categories[categoryIndex];
            const activity = category.activities[activityIndex];
            const point = activity.points[pointIndex];
            
            Object.assign(point, updates);
            
            updateUI();
            updateStatusBar(`–¢–æ—á–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞: ${point.id}`);
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
        function savePointInModal() {
            const pointIndex = parseInt(pointModal.dataset.pointIndex);
            const activityIndex = parseInt(pointModal.dataset.activityIndex);
            const categoryIndex = parseInt(pointModal.dataset.categoryIndex);
            const cityIndex = parseInt(pointModal.dataset.cityIndex);
            
            const updates = {
                x: parseInt(modalPointX.value) || 0,
                y: parseInt(modalPointY.value) || 0,
                height: modalPointHeight.value ? parseInt(modalPointHeight.value) : null,
                label: modalPointLabel.value || null,
                description: modalPointDescription.value || null,
                note: modalPointNote.value || null,
                collected: modalPointCollected.checked
            };
            
            updatePoint(cityIndex, categoryIndex, activityIndex, pointIndex, updates);
            pointModal.style.display = 'none';
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ—á–∫–∏
        function openPointModal(cityIndex, categoryIndex, activityIndex, pointIndex) {
            const city = data.cities[cityIndex];
            const category = city.categories[categoryIndex];
            const activity = category.activities[activityIndex];
            const point = activity.points[pointIndex];
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –≤ dataset –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            pointModal.dataset.cityIndex = cityIndex;
            pointModal.dataset.categoryIndex = categoryIndex;
            pointModal.dataset.activityIndex = activityIndex;
            pointModal.dataset.pointIndex = pointIndex;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è
            modalPointX.value = point.x;
            modalPointY.value = point.y;
            modalPointHeight.value = point.height || '';
            modalPointLabel.value = point.label || '';
            modalPointDescription.value = point.description || '';
            modalPointNote.value = point.note || '';
            modalPointCollected.checked = point.collected;
            modalPointId.textContent = point.id;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            pointModal.style.display = 'flex';
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ—á–∫–∏ –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function deletePointInModal() {
            const pointIndex = parseInt(pointModal.dataset.pointIndex);
            const activityIndex = parseInt(pointModal.dataset.activityIndex);
            const categoryIndex = parseInt(pointModal.dataset.categoryIndex);
            const cityIndex = parseInt(pointModal.dataset.cityIndex);
            
            deletePoint(cityIndex, categoryIndex, activityIndex, pointIndex);
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function toggleViewMode(mode) {
            currentView.viewMode = mode;
            updateContent();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥ —Å–æ —Å–ø–∏—Å–∫–æ–º –≥–æ—Ä–æ–¥–æ–≤
        function showCitiesView() {
            currentView = {
                type: 'cities',
                cityIndex: -1,
                categoryIndex: -1,
                activityIndex: -1,
                viewMode: currentView.viewMode
            };
            
            navigationHistory = [];
            updateUI();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥ –≥–æ—Ä–æ–¥–∞
        function showCityView(cityIndex) {
            if (cityIndex === -1) return showCitiesView();
            
            currentView = {
                type: 'city',
                cityIndex: cityIndex,
                categoryIndex: -1,
                activityIndex: -1,
                viewMode: currentView.viewMode
            };
            
            navigationHistory.push({
                type: 'cities',
                cityIndex: -1,
                categoryIndex: -1,
                activityIndex: -1
            });
            
            updateUI();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function showCategoryView(cityIndex, categoryIndex) {
            if (cityIndex === -1 || categoryIndex === -1) {
                if (cityIndex !== -1) {
                    showCityView(cityIndex);
                } else {
                    showCitiesView();
                }
                return;
            }
            
            currentView = {
                type: 'category',
                cityIndex: cityIndex,
                categoryIndex: categoryIndex,
                activityIndex: -1,
                viewMode: currentView.viewMode
            };
            
            navigationHistory.push({
                type: 'city',
                cityIndex: cityIndex,
                categoryIndex: -1,
                activityIndex: -1
            });
            
            updateUI();
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function showActivityView(cityIndex, categoryIndex, activityIndex) {
            if (cityIndex === -1 || categoryIndex === -1 || activityIndex === -1) {
                if (cityIndex !== -1 && categoryIndex !== -1) {
                    showCategoryView(cityIndex, categoryIndex);
                } else if (cityIndex !== -1) {
                    showCityView(cityIndex);
                } else {
                    showCitiesView();
                }
                return;
            }
            
            currentView = {
                type: 'activity',
                cityIndex: cityIndex,
                categoryIndex: categoryIndex,
                activityIndex: activityIndex,
                viewMode: currentView.viewMode
            };
            
            navigationHistory.push({
                type: 'category',
                cityIndex: cityIndex,
                categoryIndex: categoryIndex,
                activityIndex: -1
            });
            
            updateUI();
        }
        
        // –ù–∞–∑–∞–¥ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏
        function goBack() {
            if (navigationHistory.length > 0) {
                currentView = navigationHistory.pop();
                updateUI();
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            updateNavigation();
            updateContent();
            updateBreadcrumb();
            updateStatusBar();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateNavigation() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            updateCitiesNavList();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            if (currentView.cityIndex !== -1) {
                categoriesNavSection.style.display = 'block';
                updateCategoriesNavList();
                
                if (currentView.categoryIndex !== -1) {
                    activitiesNavSection.style.display = 'block';
                    updateActivitiesNavList();
                    
                    if (currentView.activityIndex !== -1) {
                        pointsNavSection.style.display = 'block';
                        updatePointsNavList();
                    } else {
                        pointsNavSection.style.display = 'none';
                    }
                } else {
                    activitiesNavSection.style.display = 'none';
                    pointsNavSection.style.display = 'none';
                }
            } else {
                categoriesNavSection.style.display = 'none';
                activitiesNavSection.style.display = 'none';
                pointsNavSection.style.display = 'none';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≥–æ—Ä–æ–¥–æ–≤ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateCitiesNavList() {
            citiesNavList.innerHTML = '';
            
            if (data.cities.length === 0) {
                citiesNavList.innerHTML = '<div style="padding: 10px; color: #95a5a6; text-align: center; font-size: 12px;">–ù–µ—Ç –≥–æ—Ä–æ–¥–æ–≤</div>';
                return;
            }
            
            data.cities.forEach((city, index) => {
                const item = document.createElement('div');
                item.className = `list-item ${index === currentView.cityIndex ? 'selected' : ''}`;
                item.innerHTML = `
                    <div class="item-content">
                        <div class="item-name">${city.name}</div>
                        <div class="item-id">${city.id}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-delete" onclick="event.stopPropagation(); deleteCity(${index});">√ó</button>
                    </div>
                `;
                item.addEventListener('click', () => showCityView(index));
                citiesNavList.appendChild(item);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateCategoriesNavList() {
            if (currentView.cityIndex === -1) return;
            
            categoriesNavList.innerHTML = '';
            const city = data.cities[currentView.cityIndex];
            
            if (city.categories.length === 0) {
                categoriesNavList.innerHTML = '<div style="padding: 10px; color: #95a5a6; text-align: center; font-size: 12px;">–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>';
                return;
            }
            
            city.categories.forEach((category, index) => {
                const item = document.createElement('div');
                item.className = `list-item ${index === currentView.categoryIndex ? 'selected' : ''}`;
                item.innerHTML = `
                    <div class="item-content">
                        <div class="item-name">${category.name}</div>
                        <div class="item-id">${category.id}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-delete" onclick="event.stopPropagation(); deleteCategory(${currentView.cityIndex}, ${index});">√ó</button>
                    </div>
                `;
                item.addEventListener('click', () => showCategoryView(currentView.cityIndex, index));
                categoriesNavList.appendChild(item);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updateActivitiesNavList() {
            if (currentView.cityIndex === -1 || currentView.categoryIndex === -1) return;
            
            activitiesNavList.innerHTML = '';
            const city = data.cities[currentView.cityIndex];
            const category = city.categories[currentView.categoryIndex];
            
            if (category.activities.length === 0) {
                activitiesNavList.innerHTML = '<div style="padding: 10px; color: #95a5a6; text-align: center; font-size: 12px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π</div>';
                return;
            }
            
            category.activities.forEach((activity, index) => {
                const item = document.createElement('div');
                item.className = `list-item ${index === currentView.activityIndex ? 'selected' : ''}`;
                item.innerHTML = `
                    <div class="item-content">
                        <div class="item-name">
                            ${activity.icon ? `<span style="margin-right: 5px; font-size: 12px;">${activity.icon}</span>` : ''}
                            ${activity.name}
                        </div>
                        <div class="item-id">${activity.id}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-delete" onclick="event.stopPropagation(); deleteActivity(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index});">√ó</button>
                    </div>
                `;
                item.addEventListener('click', () => showActivityView(currentView.cityIndex, currentView.categoryIndex, index));
                activitiesNavList.appendChild(item);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ—á–µ–∫ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function updatePointsNavList() {
            if (currentView.cityIndex === -1 || currentView.categoryIndex === -1 || currentView.activityIndex === -1) return;
            
            pointsNavList.innerHTML = '';
            const city = data.cities[currentView.cityIndex];
            const category = city.categories[currentView.categoryIndex];
            const activity = category.activities[currentView.activityIndex];
            
            if (activity.points.length === 0) {
                pointsNavList.innerHTML = '<div style="padding: 10px; color: #95a5a6; text-align: center; font-size: 12px;">–ù–µ—Ç —Ç–æ—á–µ–∫</div>';
                return;
            }
            
            activity.points.forEach((point, index) => {
                const item = document.createElement('div');
                item.className = `list-item`;
                item.innerHTML = `
                    <div class="item-content">
                        <div class="item-name">${point.id}</div>
                        <div class="item-id">(${point.x}, ${point.y}) ${point.collected ? '‚úì' : ''}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-delete" onclick="event.stopPropagation(); deletePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index});">√ó</button>
                    </div>
                `;
                item.addEventListener('click', () => openPointModal(currentView.cityIndex, currentView.categoryIndex, currentView.activityIndex, index));
                pointsNavList.appendChild(item);
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
        function updateContent() {
            content.innerHTML = '';
            headerActions.innerHTML = '';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∞ –¥–ª—è –í–°–ï–• —Ç–∏–ø–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
            const viewToggle = document.createElement('div');
            viewToggle.className = 'view-toggle';
            viewToggle.innerHTML = `
                <button class="view-toggle-btn ${currentView.viewMode === 'grid' ? 'active' : ''}" onclick="toggleViewMode('grid')">–°–µ—Ç–∫–∞</button>
                <button class="view-toggle-btn ${currentView.viewMode === 'list' ? 'active' : ''}" onclick="toggleViewMode('list')">–°–ø–∏—Å–æ–∫</button>
            `;
            content.appendChild(viewToggle);
            
            switch (currentView.type) {
                case 'cities':
                    renderCitiesView();
                    break;
                case 'city':
                    renderCityView();
                    break;
                case 'category':
                    renderCategoryView();
                    break;
                case 'activity':
                    renderActivityView();
                    break;
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä –≤–∏–¥–∞ –≥–æ—Ä–æ–¥–æ–≤
        function renderCitiesView() {
            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞
            const addBtn = document.createElement('button');
            addBtn.className = 'btn btn-add';
            addBtn.innerHTML = '<span>+</span> –î–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥';
            addBtn.addEventListener('click', addCity);
            headerActions.appendChild(addBtn);
            
            // –°–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤
            if (data.cities.length === 0) {
                content.innerHTML += '<div class="empty-message">–ù–µ—Ç –≥–æ—Ä–æ–¥–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –≥–æ—Ä–æ–¥.</div>';
                return;
            }
            
            if (currentView.viewMode === 'grid') {
                const citiesContainer = document.createElement('div');
                citiesContainer.className = 'city-list';
                
                data.cities.forEach((city, index) => {
                    const card = document.createElement('div');
                    card.className = 'city-card';
                    card.innerHTML = `
                        <div class="card-header">
                            <input type="text" class="input-inline" value="${city.name}" 
                                   onchange="updateCity(${index}, this.value)">
                            <div class="card-actions">
                                <button class="btn btn-delete" onclick="deleteCity(${index}); event.stopPropagation();">√ó</button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div style="margin-bottom: 5px;">ID: <strong>${city.id}</strong></div>
                            <div class="card-stats">
                                <span>–ö–∞—Ç–µ–≥–æ—Ä–∏–π: ${city.categories.length}</span>
                                <span>Next ID: ${city.nextCategoryId}</span>
                            </div>
                        </div>
                    `;
                    card.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('input-inline') && 
                            !e.target.classList.contains('btn-delete')) {
                            showCityView(index);
                        }
                    });
                    citiesContainer.appendChild(card);
                });
                
                content.appendChild(citiesContainer);
            } else {
                // –†–µ–∂–∏–º —Å–ø–∏—Å–∫–∞ - —Ç–∞–±–ª–∏—Ü–∞
                const table = document.createElement('table');
                table.className = 'list-view-table';
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th style="width: 40%;">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th style="width: 15%;">ID</th>
                            <th style="width: 20%;">–ö–∞—Ç–µ–≥–æ—Ä–∏–π</th>
                            <th style="width: 15%;">Next ID</th>
                            <th style="width: 10%;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="citiesTableBody"></tbody>
                `;
                
                const tableBody = table.querySelector('#citiesTableBody');
                
                data.cities.forEach((city, index) => {
                    const row = document.createElement('tr');
                    row.className = index === currentView.cityIndex ? 'selected' : '';
                    row.innerHTML = `
                        <td>
                            <input type="text" value="${city.name}" 
                                   onchange="updateCity(${index}, this.value)" style="width: 100%;">
                        </td>
                        <td><code>${city.id}</code></td>
                        <td>${city.categories.length}</td>
                        <td>${city.nextCategoryId}</td>
                        <td>
                            <div class="list-view-actions">
                                <button class="btn" onclick="showCityView(${index}); event.stopPropagation();">–û—Ç–∫—Ä—ã—Ç—å</button>
                                <button class="btn btn-delete" onclick="deleteCity(${index}); event.stopPropagation();">√ó</button>
                            </div>
                        </td>
                    `;
                    row.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('btn') && e.target.type !== 'text') {
                            showCityView(index);
                        }
                    });
                    tableBody.appendChild(row);
                });
                
                const listContainer = document.createElement('div');
                listContainer.className = 'list-view';
                listContainer.appendChild(table);
                content.appendChild(listContainer);
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä –≤–∏–¥–∞ –≥–æ—Ä–æ–¥–∞
        function renderCityView() {
            const city = data.cities[currentView.cityIndex];
            
            // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
            const backBtn = document.createElement('button');
            backBtn.className = 'btn btn-back';
            backBtn.innerHTML = '‚Üê –ù–∞–∑–∞–¥';
            backBtn.addEventListener('click', goBack);
            headerActions.appendChild(backBtn);
            
            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const addBtn = document.createElement('button');
            addBtn.className = 'btn btn-add';
            addBtn.innerHTML = '<span>+</span> –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é';
            addBtn.addEventListener('click', () => addCategory(currentView.cityIndex));
            headerActions.appendChild(addBtn);
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥–æ—Ä–æ–¥–µ
            const info = document.createElement('div');
            info.className = 'edit-info';
            info.innerHTML = `
                <div class="edit-info-row">
                    <div class="edit-info-label">–ù–∞–∑–≤–∞–Ω–∏–µ:</div>
                    <div class="edit-info-value"><strong>${city.name}</strong></div>
                </div>
                <div class="edit-info-row">
                    <div class="edit-info-label">ID:</div>
                    <div class="edit-info-value"><code>${city.id}</code></div>
                </div>
                <div class="edit-info-row">
                    <div class="edit-info-label">Next Category ID:</div>
                    <div class="edit-info-value">${city.nextCategoryId}</div>
                </div>
            `;
            content.appendChild(info);
            
            // –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            if (city.categories.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'empty-message';
                emptyMsg.textContent = '–ù–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é.';
                content.appendChild(emptyMsg);
                return;
            }
            
            if (currentView.viewMode === 'grid') {
                const categoriesContainer = document.createElement('div');
                categoriesContainer.className = 'category-list';
                
                city.categories.forEach((category, index) => {
                    const card = document.createElement('div');
                    card.className = 'category-card';
                    card.innerHTML = `
                        <div class="card-header">
                            <input type="text" class="input-inline" value="${category.name}" 
                                   onchange="updateCategory(${currentView.cityIndex}, ${index}, this.value)">
                            <div class="card-actions">
                                <button class="btn btn-delete" onclick="deleteCategory(${currentView.cityIndex}, ${index}); event.stopPropagation();">√ó</button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div style="margin-bottom: 5px;">ID: <strong>${category.id}</strong></div>
                            <div class="card-stats">
                                <span>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π: ${category.activities.length}</span>
                                <span>Next ID: ${category.nextActivityId}</span>
                            </div>
                        </div>
                    `;
                    card.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('input-inline') && 
                            !e.target.classList.contains('btn-delete')) {
                            showCategoryView(currentView.cityIndex, index);
                        }
                    });
                    categoriesContainer.appendChild(card);
                });
                
                content.appendChild(categoriesContainer);
            } else {
                // –†–µ–∂–∏–º —Å–ø–∏—Å–∫–∞ - —Ç–∞–±–ª–∏—Ü–∞
                const table = document.createElement('table');
                table.className = 'list-view-table';
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th style="width: 40%;">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th style="width: 15%;">ID</th>
                            <th style="width: 20%;">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π</th>
                            <th style="width: 15%;">Next ID</th>
                            <th style="width: 10%;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="categoriesTableBody"></tbody>
                `;
                
                const tableBody = table.querySelector('#categoriesTableBody');
                
                city.categories.forEach((category, index) => {
                    const row = document.createElement('tr');
                    row.className = index === currentView.categoryIndex ? 'selected' : '';
                    row.innerHTML = `
                        <td>
                            <input type="text" value="${category.name}" 
                                   onchange="updateCategory(${currentView.cityIndex}, ${index}, this.value)" style="width: 100%;">
                        </td>
                        <td><code>${category.id}</code></td>
                        <td>${category.activities.length}</td>
                        <td>${category.nextActivityId}</td>
                        <td>
                            <div class="list-view-actions">
                                <button class="btn" onclick="showCategoryView(${currentView.cityIndex}, ${index}); event.stopPropagation();">–û—Ç–∫—Ä—ã—Ç—å</button>
                                <button class="btn btn-delete" onclick="deleteCategory(${currentView.cityIndex}, ${index}); event.stopPropagation();">√ó</button>
                            </div>
                        </td>
                    `;
                    row.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('btn') && e.target.type !== 'text') {
                            showCategoryView(currentView.cityIndex, index);
                        }
                    });
                    tableBody.appendChild(row);
                });
                
                const listContainer = document.createElement('div');
                listContainer.className = 'list-view';
                listContainer.appendChild(table);
                content.appendChild(listContainer);
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä –≤–∏–¥–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function renderCategoryView() {
            const city = data.cities[currentView.cityIndex];
            const category = city.categories[currentView.categoryIndex];
            
            // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
            const backBtn = document.createElement('button');
            backBtn.className = 'btn btn-back';
            backBtn.innerHTML = '‚Üê –ù–∞–∑–∞–¥';
            backBtn.addEventListener('click', goBack);
            headerActions.appendChild(backBtn);
            
            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            const addBtn = document.createElement('button');
            addBtn.className = 'btn btn-add';
            addBtn.innerHTML = '<span>+</span> –î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å';
            addBtn.addEventListener('click', () => addActivity(currentView.cityIndex, currentView.categoryIndex));
            headerActions.appendChild(addBtn);
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const info = document.createElement('div');
            info.className = 'edit-info';
            info.innerHTML = `
                <div class="edit-info-row">
                    <div class="edit-info-label">–ù–∞–∑–≤–∞–Ω–∏–µ:</div>
                    <div class="edit-info-value"><strong>${category.name}</strong></div>
                </div>
                <div class="edit-info-row">
                    <div class="edit-info-label">ID:</div>
                    <div class="edit-info-value"><code>${category.id}</code></div>
                </div>
                <div class="edit-info-row">
                    <div class="edit-info-label">Next Activity ID:</div>
                    <div class="edit-info-value">${category.nextActivityId}</div>
                </div>
            `;
            content.appendChild(info);
            
            // –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
            if (category.activities.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'empty-message';
                emptyMsg.textContent = '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.';
                content.appendChild(emptyMsg);
                return;
            }
            
            if (currentView.viewMode === 'grid') {
                const activitiesContainer = document.createElement('div');
                activitiesContainer.className = 'activity-list';
                
                category.activities.forEach((activity, index) => {
                    const card = document.createElement('div');
                    card.className = 'activity-card';
                    card.innerHTML = `
                        <div class="card-header">
                            <div style="display: flex; align-items: center; gap: 8px; width: 100%;">
                                ${activity.icon ? `<span style="font-size: 20px;">${activity.icon}</span>` : ''}
                                <input type="text" class="input-inline" value="${activity.name}" 
                                       onchange="updateActivity(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index}, {name: this.value})" style="flex-grow: 1;">
                            </div>
                            <div class="card-actions">
                                <button class="btn btn-delete" onclick="deleteActivity(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index}); event.stopPropagation();">√ó</button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="form-group" style="margin-bottom: 10px;">
                                <input type="text" class="form-control" value="${activity.icon || ''}" placeholder="–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)"
                                       onchange="updateActivity(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index}, {icon: this.value || null})">
                            </div>
                            <div class="checkbox-group">
                                <input type="checkbox" id="show-${index}" ${activity.show ? 'checked' : ''}
                                       onchange="updateActivity(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index}, {show: this.checked})">
                                <label for="show-${index}">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å</label>
                            </div>
                            <div class="card-stats">
                                <span>ID: <code>${activity.id}</code></span>
                                <span>–¢–æ—á–µ–∫: ${activity.points.length}</span>
                                <span>Next ID: ${activity.nextPointId}</span>
                            </div>
                        </div>
                    `;
                    card.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('input-inline') && 
                            !e.target.classList.contains('form-control') &&
                            !e.target.classList.contains('btn-delete') &&
                            e.target.type !== 'checkbox') {
                            showActivityView(currentView.cityIndex, currentView.categoryIndex, index);
                        }
                    });
                    activitiesContainer.appendChild(card);
                });
                
                content.appendChild(activitiesContainer);
            } else {
                // –†–µ–∂–∏–º —Å–ø–∏—Å–∫–∞ - —Ç–∞–±–ª–∏—Ü–∞
                const table = document.createElement('table');
                table.className = 'list-view-table';
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th style="width: 30%;">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                            <th style="width: 10%;">–ò–∫–æ–Ω–∫–∞</th>
                            <th style="width: 15%;">ID</th>
                            <th style="width: 15%;">–¢–æ—á–µ–∫</th>
                            <th style="width: 10%;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å</th>
                            <th style="width: 10%;">Next ID</th>
                            <th style="width: 10%;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="activitiesTableBody"></tbody>
                `;
                
                const tableBody = table.querySelector('#activitiesTableBody');
                
                category.activities.forEach((activity, index) => {
                    const row = document.createElement('tr');
                    row.className = index === currentView.activityIndex ? 'selected' : '';
                    row.innerHTML = `
                        <td>
                            <input type="text" value="${activity.name}" 
                                   onchange="updateActivity(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index}, {name: this.value})" style="width: 100%;">
                        </td>
                        <td>
                            <input type="text" value="${activity.icon || ''}" 
                                   onchange="updateActivity(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index}, {icon: this.value || null})" style="width: 100%;" placeholder="–ò–∫–æ–Ω–∫–∞">
                        </td>
                        <td><code>${activity.id}</code></td>
                        <td>${activity.points.length}</td>
                        <td>
                            <input type="checkbox" ${activity.show ? 'checked' : ''}
                                   onchange="updateActivity(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index}, {show: this.checked})">
                        </td>
                        <td>${activity.nextPointId}</td>
                        <td>
                            <div class="list-view-actions">
                                <button class="btn" onclick="showActivityView(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index}); event.stopPropagation();">–û—Ç–∫—Ä—ã—Ç—å</button>
                                <button class="btn btn-delete" onclick="deleteActivity(${currentView.cityIndex}, ${currentView.categoryIndex}, ${index}); event.stopPropagation();">√ó</button>
                            </div>
                        </td>
                    `;
                    row.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('btn') && e.target.type !== 'text' && e.target.type !== 'checkbox') {
                            showActivityView(currentView.cityIndex, currentView.categoryIndex, index);
                        }
                    });
                    tableBody.appendChild(row);
                });
                
                const listContainer = document.createElement('div');
                listContainer.className = 'list-view';
                listContainer.appendChild(table);
                content.appendChild(listContainer);
            }
        }
        
        // –†–µ–Ω–¥–µ—Ä –≤–∏–¥–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function renderActivityView() {
            const city = data.cities[currentView.cityIndex];
            const category = city.categories[currentView.categoryIndex];
            const activity = category.activities[currentView.activityIndex];
            
            // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
            const backBtn = document.createElement('button');
            backBtn.className = 'btn btn-back';
            backBtn.innerHTML = '‚Üê –ù–∞–∑–∞–¥';
            backBtn.addEventListener('click', goBack);
            headerActions.appendChild(backBtn);
            
            // –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏
            const addBtn = document.createElement('button');
            addBtn.className = 'btn btn-add';
            addBtn.innerHTML = '<span>+</span> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É';
            addBtn.addEventListener('click', () => addPoint(currentView.cityIndex, currentView.categoryIndex, currentView.activityIndex));
            headerActions.appendChild(addBtn);
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            const info = document.createElement('div');
            info.className = 'edit-info';
            info.innerHTML = `
                <div class="edit-info-row">
                    <div class="edit-info-label">–ù–∞–∑–≤–∞–Ω–∏–µ:</div>
                    <div class="edit-info-value"><strong>${activity.name}</strong></div>
                </div>
                <div class="edit-info-row">
                    <div class="edit-info-label">ID:</div>
                    <div class="edit-info-value"><code>${activity.id}</code></div>
                </div>
                <div class="edit-info-row">
                    <div class="edit-info-label">Next Point ID:</div>
                    <div class="edit-info-value">${activity.nextPointId}</div>
                </div>
                <div class="edit-info-row">
                    <div class="edit-info-label">–ò–∫–æ–Ω–∫–∞:</div>
                    <div class="edit-info-value">${activity.icon || '–Ω–µ—Ç'}</div>
                </div>
                <div class="edit-info-row">
                    <div class="edit-info-label">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:</div>
                    <div class="edit-info-value">${activity.show ? '–î–∞' : '–ù–µ—Ç'}</div>
                </div>
            `;
            content.appendChild(info);
            
            // –°–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫
            if (activity.points.length === 0) {
                const emptyMsg = document.createElement('div');
                emptyMsg.className = 'empty-message';
                emptyMsg.textContent = '–ù–µ—Ç —Ç–æ—á–µ–∫. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É.';
                content.appendChild(emptyMsg);
                return;
            }
            
            if (currentView.viewMode === 'grid') {
                // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ –≤–∏–¥–µ —Å–µ—Ç–∫–∏
                const pointsContainer = document.createElement('div');
                pointsContainer.className = 'point-list';
                
                activity.points.forEach((point, index) => {
                    const card = document.createElement('div');
                    card.className = 'point-card';
                    card.innerHTML = `
                        <h4>
                            <span>–¢–æ—á–∫–∞ ${point.id}</span>
                            <span class="point-id">${point.collected ? '‚úì –°–æ–±—Ä–∞–Ω–∞' : '–ù–µ —Å–æ–±—Ä–∞–Ω–∞'}</span>
                        </h4>
                        <div class="point-coords">
                            <div class="form-group">
                                <label>X</label>
                                <input type="number" class="form-control" value="${point.x}" 
                                       onchange="updatePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}, {x: parseInt(this.value) || 0})">
                            </div>
                            <div class="form-group">
                                <label>Y</label>
                                <input type="number" class="form-control" value="${point.y}" 
                                       onchange="updatePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}, {y: parseInt(this.value) || 0})">
                            </div>
                            <div class="form-group">
                                <label>–í—ã—Å–æ—Ç–∞</label>
                                <input type="number" class="form-control" value="${point.height || ''}" 
                                       onchange="updatePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}, {height: this.value ? parseInt(this.value) : null})">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–ú–µ—Ç–∫–∞</label>
                            <input type="text" class="form-control" value="${point.label || ''}" 
                                   onchange="updatePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}, {label: this.value || null})">
                        </div>
                        <div class="action-buttons">
                            <button class="btn" onclick="openPointModal(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é</button>
                            <button class="btn btn-delete" onclick="deletePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    `;
                    pointsContainer.appendChild(card);
                });
                
                content.appendChild(pointsContainer);
            } else {
                // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞
                const table = document.createElement('table');
                table.className = 'list-view-table';
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th style="width: 10%;">ID</th>
                            <th style="width: 15%;">X</th>
                            <th style="width: 15%;">Y</th>
                            <th style="width: 15%;">–í—ã—Å–æ—Ç–∞</th>
                            <th style="width: 20%;">–ú–µ—Ç–∫–∞</th>
                            <th style="width: 10%;">–°–æ–±—Ä–∞–Ω–∞</th>
                            <th style="width: 15%;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="pointsTableBody"></tbody>
                `;
                
                const tableBody = table.querySelector('#pointsTableBody');
                
                activity.points.forEach((point, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><code>${point.id}</code></td>
                        <td>
                            <input type="number" value="${point.x}" 
                                   onchange="updatePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}, {x: parseInt(this.value) || 0})" style="width: 100%;">
                        </td>
                        <td>
                            <input type="number" value="${point.y}" 
                                   onchange="updatePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}, {y: parseInt(this.value) || 0})" style="width: 100%;">
                        </td>
                        <td>
                            <input type="number" value="${point.height || ''}" 
                                   onchange="updatePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}, {height: this.value ? parseInt(this.value) : null})" style="width: 100%;">
                        </td>
                        <td>
                            <input type="text" value="${point.label || ''}" 
                                   onchange="updatePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}, {label: this.value || null})" style="width: 100%;">
                        </td>
                        <td>
                            <input type="checkbox" ${point.collected ? 'checked' : ''}
                                   onchange="updatePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}, {collected: this.checked})">
                        </td>
                        <td>
                            <div class="list-view-actions">
                                <button class="btn" onclick="openPointModal(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}); event.stopPropagation();">–ü–æ–¥—Ä–æ–±–Ω–æ</button>
                                <button class="btn btn-delete" onclick="deletePoint(${currentView.cityIndex}, ${currentView.categoryIndex}, ${currentView.activityIndex}, ${index}); event.stopPropagation();">√ó</button>
                            </div>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
                
                const listContainer = document.createElement('div');
                listContainer.className = 'list-view';
                listContainer.appendChild(table);
                content.appendChild(listContainer);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫
        function updateBreadcrumb() {
            breadcrumb.innerHTML = '';
            
            // –ö–æ—Ä–µ–Ω—å
            const rootItem = document.createElement('span');
            rootItem.className = 'breadcrumb-item';
            rootItem.textContent = '–†–µ–¥–∞–∫—Ç–æ—Ä';
            rootItem.addEventListener('click', showCitiesView);
            breadcrumb.appendChild(rootItem);
            
            // –ì–æ—Ä–æ–¥
            if (currentView.cityIndex !== -1) {
                const city = data.cities[currentView.cityIndex];
                const separator = document.createElement('span');
                separator.className = 'breadcrumb-separator';
                separator.textContent = '‚Ä∫';
                breadcrumb.appendChild(separator);
                
                const cityItem = document.createElement('span');
                cityItem.className = 'breadcrumb-item';
                cityItem.textContent = city.name;
                cityItem.addEventListener('click', () => showCityView(currentView.cityIndex));
                breadcrumb.appendChild(cityItem);
            }
            
            // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
            if (currentView.categoryIndex !== -1) {
                const city = data.cities[currentView.cityIndex];
                const category = city.categories[currentView.categoryIndex];
                const separator = document.createElement('span');
                separator.className = 'breadcrumb-separator';
                separator.textContent = '‚Ä∫';
                breadcrumb.appendChild(separator);
                
                const categoryItem = document.createElement('span');
                categoryItem.className = 'breadcrumb-item';
                categoryItem.textContent = category.name;
                categoryItem.addEventListener('click', () => showCategoryView(currentView.cityIndex, currentView.categoryIndex));
                breadcrumb.appendChild(categoryItem);
            }
            
            // –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            if (currentView.activityIndex !== -1) {
                const city = data.cities[currentView.cityIndex];
                const category = city.categories[currentView.categoryIndex];
                const activity = category.activities[currentView.activityIndex];
                const separator = document.createElement('span');
                separator.className = 'breadcrumb-separator';
                separator.textContent = '‚Ä∫';
                breadcrumb.appendChild(separator);
                
                const activityItem = document.createElement('span');
                activityItem.className = 'breadcrumb-item';
                activityItem.textContent = activity.name;
                activityItem.addEventListener('click', () => showActivityView(currentView.cityIndex, currentView.categoryIndex, currentView.activityIndex));
                breadcrumb.appendChild(activityItem);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–∞
        function updateStatusBar(message = null) {
            if (message) {
                statusBar.textContent = message;
                return;
            }
            
            const citiesCount = data.cities.length;
            let categoriesCount = 0;
            let activitiesCount = 0;
            let pointsCount = 0;
            
            data.cities.forEach(city => {
                categoriesCount += city.categories.length;
                city.categories.forEach(category => {
                    activitiesCount += category.activities.length;
                    category.activities.forEach(activity => {
                        pointsCount += activity.points.length;
                    });
                });
            });
            
            statusBar.textContent = `–ì–æ—Ä–æ–¥–æ–≤: ${citiesCount} | –ö–∞—Ç–µ–≥–æ—Ä–∏–π: ${categoriesCount} | –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π: ${activitiesCount} | –¢–æ—á–µ–∫: ${pointsCount}`;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('DOMContentLoaded', init);
        
        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ inline –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö
        window.deleteCity = deleteCity;
        window.deleteCategory = deleteCategory;
        window.deleteActivity = deleteActivity;
        window.deletePoint = deletePoint;
        window.updateCity = updateCity;
        window.updateCategory = updateCategory;
        window.updateActivity = updateActivity;
        window.updatePoint = updatePoint;
        window.openPointModal = openPointModal;
        window.toggleViewMode = toggleViewMode;
        window.showCityView = showCityView;
        window.showCategoryView = showCategoryView;
        window.showActivityView = showActivityView;
        window.goBack = goBack;
        window.showCitiesView = showCitiesView;
    </script>
</body>
</html>